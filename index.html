<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>姿势识别小练习 - Web Demo</title>
  <style>
    :root {
      --bg: #0b1020;
      --surface: #0f172a;
      --surface-2: #101426;
      --border: #1e293b;
      --border-2: #334155;
      --text: #eef2ff;
      --muted: #cbd5e1;
      --primary: #6366f1;
      --primary-600: #4f46e5;
      --accent: #22d3ee;
      --accent-2: #818cf8;
      --success: #34d399;
    }

    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 0; padding: 16px; background: var(--bg); color: var(--text); }
    .wrap { max-width: 1100px; margin: 0 auto; }

    .toolbar { display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap: wrap; }
    button { background: var(--primary); color:#fff; border:1px solid transparent; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; transition: background .15s ease, transform .05s ease, box-shadow .15s ease; box-shadow: 0 4px 14px rgba(79,70,229,.2); }
    button:hover { background: var(--primary-600); }
    button:active { transform: translateY(1px); box-shadow: 0 2px 8px rgba(79,70,229,.25); }
    button:disabled { opacity:.6; cursor:not-allowed; box-shadow: none; }

    select { background: #1e293b; color:#e2e8f0; border:1px solid var(--border-2); padding:8px 10px; border-radius:10px; }
    select:focus { outline: 2px solid var(--primary-600); outline-offset: 1px; }

    .row { display:flex; gap:16px; align-items:stretch; flex-wrap: wrap; }

    .guide { flex: 0 0 300px; max-width: 100%; background: var(--surface); border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow: 0 8px 28px rgba(0,0,0,.25); }
    .guide h3 { margin:0 0 8px 0; font-size:16px; color:#e2e8f0; }
    .guide .card { position: relative; width: 100%; aspect-ratio: 1/1; background: linear-gradient(180deg, #0b1224, #0a1020); border-radius:10px; overflow:hidden; border:1px solid var(--border); }
    .guide canvas { position:absolute; inset:0; width:100%; height:100%; }

    .stage { position: relative; flex: 1 1 600px; min-width: 320px; aspect-ratio: 4/3; background: radial-gradient(1200px 600px at 40% 0%, #121836 0%, var(--surface-2) 60%); border-radius:12px; overflow:hidden; border:1px solid var(--border); box-shadow: 0 10px 32px rgba(0,0,0,.35); }
    video, canvas#canvas { position:absolute; inset:0; width:100%; height:100%; }
    video { transform: scaleX(-1); display:none; }

    .stats { margin-top: 12px; font-size: 14px; color:#c7d2fe; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background: rgba(30,41,59,.6); margin-right:6px; border:1px solid var(--border-2); color:#dbeafe; box-shadow: inset 0 -1px 0 rgba(255,255,255,.04); }

    a { color:#93c5fd; }
    label.inline { display:flex; align-items:center; gap:6px; }

    .settings { margin-top: 14px; padding: 12px; background: var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow: 0 8px 28px rgba(0,0,0,.25); }
    .settings h3 { margin: 0 0 10px 0; font-size: 16px; color:#e2e8f0; }
    .settings .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .settings label { font-size: 14px; color:var(--muted); }
    .settings input { background:#111827; color:#e5e7eb; border:1px solid var(--border-2); padding:8px 10px; border-radius:10px; width: 120px; }
    .settings input:focus { outline: 2px solid var(--primary-600); outline-offset: 1px; }
    .settings .spacer { flex:1; }
    .toast { display:none; margin-left: 8px; color:var(--success); }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>姿势识别（MediaPipe）Demo</h2>
    <div class="toolbar">
      <button id="startBtn">开始摄像头</button>
      <button id="stopBtn" disabled>停止</button>
      <button id="trainBtn" disabled>开始训练</button>
      <label for="modeSelect">动作</label>
      <select id="modeSelect">
        <option value="chin_tuck">下巴内收</option>
        <option value="glute_bridge">臀桥</option>
        <option value="overhead_reach">头顶上举</option>
        <option value="side_bend">侧屈伸展</option>
        <option value="hamstring_hinge">髋关节前屈拉伸</option>
      </select>
      <label class="inline"><input type="checkbox" id="voiceToggle" checked> 语音</label>
      <span id="status" class="pill">闲置</span>
      <span id="fps" class="pill" style="display:none">FPS: -</span>
      <span id="score" class="pill" style="display:none">得分: -</span>
      <span id="hold" class="pill">保持: 0.0s / 5s</span>
      <span id="completed" class="pill">完成: 0/1</span>
    </div>

    <div class="row">
      <div class="guide">
        <h3>动作演示</h3>
        <div class="card">
          <canvas id="guide"></canvas>
        </div>
      </div>
      <div class="stage">
        <video id="video" playsinline></video>
        <canvas id="canvas"></canvas>
      </div>
    </div>

    <div class="stats" id="angles">
      颈部角度（CVA）: <span id="neckAngle">-</span>° ｜ 髋角度（肩-髋-膝）: <span id="hipAngle">-</span>° ｜ 躯干倾斜: <span id="torsoTilt">-</span>° ｜ 判定: <span id="verdict">-</span>
    </div>
    <p class="stats" id="tips">
      左侧卡片为该动作的演示动画，选择动作后点击“开始训练”。
    </p>
    <div class="settings">
      <h3>设置</h3>
      <div class="row">
        <label>保持时长(秒)
          <input id="settingHoldSec" type="number" min="1" max="120" step="1" value="5"></label>
        <label><span id="settingPrimaryLabel">阈值</span>
          <input id="settingPrimary" type="number" step="1" value="55"></label>
        <span class="spacer"></span>
        <button id="saveSettingsBtn">保存设置</button>
        <button id="resetSettingsBtn">恢复默认</button>
        <span id="saveToast" class="toast">已保存</span>
      </div>
    </div>
    <p class="stats">
      若直接双击打开无法加载模型，请用本地服务器启动：在此目录终端运行
      <code>python3 -m http.server 5173</code>，然后浏览 <a href="http://localhost:5173" target="_blank">http://localhost:5173</a>。
    </p>
    <script type="module" src="./main.js?v=2"></script>
  </div>
</body>
</html> 