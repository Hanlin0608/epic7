<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pose Recognition - Web Demo</title>
  <style>
    :root {
      --bg: linear-gradient(180deg, #f6c1ad 0%, #f0a26e 35%, #ffd36b 100%);
      --surface: #0f172a;
      --surface-2: #101426;
      --border: #1e293b;
      --border-2: #334155;
      --text: #eef2ff;
      --muted: #cbd5e1;
      --primary: #6366f1;
      --primary-600: #4f46e5;
      --accent: #22d3ee;
      --accent-2: #818cf8;
      --success: #34d399;
    }

    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 0; padding: 16px; background: var(--bg); color: var(--text); }
    .wrap { max-width: 1280px; margin: 0 auto; }

    .toolbar { display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap: wrap; }
    button { background: var(--primary); color:#fff; border:1px solid transparent; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; transition: background .15s ease, transform .05s ease, box-shadow .15s ease; box-shadow: 0 4px 14px rgba(79,70,229,.2); }
    button:hover { background: var(--primary-600); }
    button:active { transform: translateY(1px); box-shadow: 0 2px 8px rgba(79,70,229,.25); }
    button:disabled { opacity:.6; cursor:not-allowed; box-shadow: none; }

    select { background: #1e293b; color:#e2e8f0; border:1px solid var(--border-2); padding:8px 10px; border-radius:10px; }
    select:focus { outline: 2px solid var(--primary-600); outline-offset: 1px; }

    .row { display:flex; gap:16px; align-items:stretch; flex-wrap: wrap; }

    .guide { flex: 0 0 300px; max-width: 100%; background: var(--surface); border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow: 0 8px 28px rgba(0,0,0,.25); }
    .guide h3 { margin:0 0 8px 0; font-size:16px; color:#e2e8f0; }
    .guide .card { position: relative; width: 100%; aspect-ratio: 1/1; background: linear-gradient(180deg, #0b1224, #0a1020); border-radius:10px; overflow:hidden; border:1px solid var(--border); }
    .guide canvas { position:absolute; inset:0; width:100%; height:100%; }

    .stage { position: relative; flex: 1 1 600px; min-width: 320px; aspect-ratio: 4/3; background: radial-gradient(1200px 600px at 40% 0%, #121836 0%, var(--surface-2) 60%); border-radius:12px; overflow:hidden; border:1px solid var(--border); box-shadow: 0 10px 32px rgba(0,0,0,.35); }
    video, canvas#canvas { position:absolute; inset:0; width:100%; height:100%; }
    video { transform: scaleX(-1); }

    .stats { margin-top: 12px; font-size: 14px; color:#0f172a; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background: rgba(30,41,59,.6); margin-right:6px; border:1px solid var(--border-2); color:#dbeafe; box-shadow: inset 0 -1px 0 rgba(255,255,255,.04); }

    a { color:#93c5fd; }
    label.inline { display:flex; align-items:center; gap:6px; }

    .settings { margin-top: 14px; padding: 12px; background: var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow: 0 8px 28px rgba(0,0,0,.25); }
    .settings h3 { margin: 0 0 10px 0; font-size: 16px; color:#e2e8f0; }
    .settings .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .settings label { font-size: 14px; color:var(--muted); }
    .settings input { background:#111827; color:#e5e7eb; border:1px solid var(--border-2); padding:8px 10px; border-radius:10px; width: 120px; }
    .settings input:focus { outline: 2px solid var(--primary-600); outline-offset: 1px; }
    .settings .spacer { flex:1; }
    .toast { display:none; margin-left: 8px; color:var(--success); }
    /* New hero layout */
    .hero { background: #ffffff; color:#0f172a; border-radius:16px; padding:18px; border:1px solid rgba(15,23,42,.12); box-shadow: 0 8px 26px rgba(0,0,0,.08); }
    .heroTop { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .heroTopRight { display:flex; align-items:center; gap:12px; }
    .iconBtn { position:relative; display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:999px; background:#0ea5e9; color:#fff; border:none; box-shadow: 0 6px 16px rgba(14,165,233,.35); cursor:pointer; }
    .iconBtn.muted { background:#94a3b8; box-shadow: 0 6px 16px rgba(148,163,184,.35); }
    .iconBtn.muted::after { content:''; position:absolute; left:50%; top:50%; width:28px; height:3px; background:#ef4444; transform: translate(-50%, -50%) rotate(45deg); border-radius:2px; box-shadow:0 2px 6px rgba(239,68,68,.35); }
    .pillBadge { background:#065f46; color:#e6fffa; padding:12px 20px; border-radius:999px; font-weight:700; font-size: clamp(16px, 2.2vw, 22px); box-shadow: inset 0 -1px 0 rgba(255,255,255,.2); }
    .scoreBadge { background:#0ea5e9; color:#fff; padding:10px 16px; border-radius:999px; font-weight:800; font-size: clamp(14px, 1.8vw, 18px); box-shadow: inset 0 -1px 0 rgba(255,255,255,.2); }
    .levelBadge { background:#facc15; color:#111827; padding:10px 18px; border-radius:999px; font-weight:700; font-size: clamp(16px, 2.0vw, 20px); }
    .heroBody { display:flex; justify-content:center; align-items:center; padding:14px 0; }
    .heroCircle { width:100%; aspect-ratio:16/9; border-radius:16px; background:#f1f5f9; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; border:1px solid var(--border-2); }
    .heroCircle canvas#heroGuide { position:absolute; top:50%; left:50%; width:50%; height:70%; transform: translate(-50%, -50%); pointer-events:none; }
    .heroDots { display:flex; gap:10px; justify-content:center; margin-top:10px; }
    .heroDot { width:10px; height:10px; border-radius:999px; background:#065f46; opacity:.8; }
    .heroActions { display:flex; gap:16px; margin-top:16px; }
    .btnPrimary { flex:1; background:#166534; color:#fff; border:none; padding:16px; border-radius:999px; font-weight:800; font-size:18px; }
    .btnGhost { flex:1; background:#e2e8f0; color:#111827; border:1px solid #cbd5e1; padding:16px; border-radius:999px; font-weight:800; font-size:18px; }
    .heroTip { text-align:center; color:#334155; margin:16px 0 6px 0; font-size: clamp(16px, 2.1vw, 22px); font-weight: 800; }
    /* Settings modal */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal .backdrop { position: absolute; inset: 0; background: rgba(2,6,23,.55); backdrop-filter: blur(2px); }
    .modal .dialog { position: relative; width: min(520px, 92vw); background: var(--surface); border:1px solid var(--border); border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,.45); padding: 16px; color: var(--text); }
    .modal h3 { margin: 0 0 12px 0; color: #e2e8f0; }
    .modal label { display:block; font-size:14px; color:#cbd5e1; margin:10px 0 6px; }
    .modal label.inline { display:inline-flex; align-items:center; gap:8px; margin:10px 0 6px; width:auto; }
    .modal input { width:100%; background:#111827; color:#e5e7eb; border:1px solid var(--border-2); padding:10px 12px; border-radius:10px; box-sizing: border-box; }
    .modal .actions { display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
    .btnMuted { background:#334155; color:#e2e8f0; border:1px solid #475569; padding:10px 14px; border-radius:10px; }
    /* Movement cards */
    .cardsWrap { margin-top: 18px; }
    .cardsHeader { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:#0f172a; }
    .cardsScroller { display:flex; gap:12px; overflow-x:auto; padding-bottom: 4px; }
    .cardMove { flex:0 0 220px; background: var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow: 0 8px 24px rgba(0,0,0,.25); color:#e2e8f0; }
    .cardMove h4 { margin:8px 10px; font-size:14px; color:#e2e8f0; }
    .cardMove .anim { position:relative; height:140px; margin: 0 10px; border-radius:10px; background: linear-gradient(180deg, #0b1224, #0a1020); border:1px solid var(--border); overflow:hidden; }
    .cardMove canvas { position:absolute; inset:0; width:100%; height:100%; }
    .cardMove p { margin:8px 10px 12px 10px; font-size:12px; color:#cbd5e1; min-height: 48px; }
    .cardMove.active { outline: 2px solid var(--accent-2); outline-offset:2px; }

    /* Celebration toast */
    .celebrate { position: absolute; left:50%; top:4%; transform: translateX(-50%); display:none; align-items:center; justify-content:center; z-index: 5; pointer-events:none; }
    .celebrate .msg { font-weight:900; font-size: clamp(32px, 5vw, 64px); white-space: nowrap; color: transparent; background: linear-gradient(90deg, #34d399, #22d3ee, #818cf8, #f472b6); -webkit-background-clip: text; background-clip: text; text-shadow: 0 8px 28px rgba(0,0,0,.3); animation: pop 800ms ease forwards; }
    @keyframes pop { 0% { transform: scale(.6); opacity: 0 } 60% { transform: scale(1.08); opacity: 1 } 100% { transform: scale(1); opacity: 1 } }
    .celebrate .spark { position:absolute; width:6px; height:6px; border-radius:999px; background: #fbbf24; box-shadow:0 0 10px rgba(251,191,36,.8); animation: fly 900ms ease forwards; }
    @keyframes fly { from { transform: translate(0,0); opacity:1 } to { transform: translate(var(--dx), var(--dy)); opacity:0 } }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Move a little game</h2>

    <section class="hero">
      <div class="heroTop">
        <div id="moveLabel" class="pillBadge">Move: Chin Tuck</div>
        <div id="gameScore" class="scoreBadge" style="display:none">Score: -</div>
        <div class="heroTopRight">
          <button id="voiceBtn" class="iconBtn" title="Voice on/off" aria-label="Voice">
            <!-- simple speaker icon -->
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 9v6h4l5 4V5L7 9H3z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 8a5 5 0 010 8" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button id="settingBtn" class="levelBadge" style="cursor:pointer">Setting</button>
        </div>
      </div>
      <div class="heroBody">
        <div class="heroCircle" id="heroCircle">
          <video id="video" playsinline></video>
          <canvas id="canvas"></canvas>
          <canvas id="heroGuide"></canvas>
        </div>
      </div>
      
      <div class="heroActions">
        <button id="heroPracticeBtn" class="btnPrimary">▶ Practice</button>
        <button id="heroPlayBtn" class="btnGhost">Play</button>
        <button id="heroFinishBtn" class="btnGhost">Finish</button>
      </div>
      <div class="heroTip" id="heroTip">Tip: Follow the guide and keep posture steadily.</div>
    </section>
    <div class="toolbar" style="display:none">
      <button id="startBtn">Start Camera</button>
      <button id="stopBtn" disabled>Stop</button>
      <button id="trainBtn" disabled>Start Training</button>
      <button id="practiceModeBtn">练习模式</button>
      <button id="scoreModeBtn">计分模式</button>
      <label for="modeSelect">Exercise</label>
      <select id="modeSelect">
        <option value="chin_tuck">Chin Tuck</option>
        <option value="overhead_reach">Overhead Reach</option>
        <option value="side_bend">Side Bend</option>
        <option value="hamstring_hinge">Hamstring Hinge</option>
        <option value="t_pose">T Pose</option>
        <option value="squat_hold">Squat Hold</option>
        <option value="quad_stretch">Quad Stretch</option>
        <option value="y_pose">Y Raise</option>
        <option value="lunge_hold">Lunge Hold</option>
        <option value="high_knee_hold">High Knee Hold</option>
      </select>
      <label for="flowMode">Mode</label>
      <select id="flowMode">
        <option value="manual">Mode 1: Manual</option>
        <option value="auto">Mode 2: Auto Sequence</option>
      </select>
      <label class="inline"><input type="checkbox" id="voiceToggle" checked> Voice</label>
      <span id="status" class="pill">Idle</span>
      <span id="fps" class="pill" style="display:none">FPS: -</span>
      <span id="score" class="pill" style="display:none">Score: -</span>
      <span id="hold" class="pill">Hold: 0.0s / 5s</span>
      <span id="completed" class="pill">Completed: 0/1</span>
    </div>

    <div class="row" style="display:none">
      <div class="stage">
        <video id="video" playsinline></video>
        <canvas id="canvas"></canvas>
      </div>
    </div>

    <div class="stats" id="angles" style="display:none">
      Neck Angle (CVA): <span id="neckAngle">-</span>° ｜ Hip Angle (Shoulder-Hip-Knee): <span id="hipAngle">-</span>° ｜ Torso Tilt: <span id="torsoTilt">-</span>° ｜ Verdict: <span id="verdict">-</span>
    </div>
    <div class="stats" style="margin-top:8px; display:none">
      <div id="holdProgress" style="height:8px; background:rgba(255,255,255,.25); border:1px solid var(--border-2); border-radius:999px; overflow:hidden;">
        <div id="holdProgressFill" style="height:100%; width:0%; background:linear-gradient(90deg, #22d3ee, #818cf8);"></div>
      </div>
    </div>
    <p class="stats" id="tips" style="display:none"></p>
    <div class="settings" style="display:none">
      <h3>Settings</h3>
      <div class="row">
        <label>Hold Duration (s)
          <input id="settingHoldSec" type="number" min="1" max="120" step="1" value="5"></label>
        
        <label><span id="settingPrimaryLabel">Threshold</span>
          <input id="settingPrimary" type="number" step="1" value="55"></label>
        <span class="spacer"></span>
        <button id="saveSettingsBtn">Save Settings</button>
        <button id="resetSettingsBtn">Reset Defaults</button>
        <span id="saveToast" class="toast">Saved</span>
      </div>
    </div>

    <div class="cardsWrap">
      <div class="cardsHeader"><strong>Movement Cards</strong></div>
      <div id="movementCards" class="cardsScroller"></div>
    </div>
    <!-- Celebration overlay (anchored within hero to appear over detection area) -->
    <div id="celebrate" class="celebrate"><div class="msg" id="celebrateMsg"></div></div>
    <p class="stats" style="display:none">
      If double-click open fails to load the model, please run a local server: in this folder
      <code>python3 -m http.server 5173</code> then visit <a href="http://localhost:5173" target="_blank">http://localhost:5173</a>.
    </p>
    <!-- Practice settings modal -->
    <div id="settingsModal" class="modal">
      <div class="backdrop"></div>
      <div class="dialog">
        <h3>Practice Settings</h3>
        <label>Hold Duration (seconds)
          <input id="modalHoldSec" type="number" min="1" max="600" step="1"></label>
        
        <!-- Voice toggle moved to top-right speaker button -->
        <div class="actions">
          <button id="modalCancelBtn" class="btnMuted">Cancel</button>
          <button id="modalSaveBtn" class="btnPrimary" style="flex:0 0 auto">Save</button>
        </div>
        
      </div>
    </div>
    <script type="module" src="./main.js?v=21"></script>
  </div>
</body>
</html> 